// jQuery Routes v1.0
// http://routesjs.com/
// 
// Copyright (c) 2011 Syntacticx
// http://syntacticx.com/
// 
// Dual licensed under the MIT or GPL Version 2 licenses.
//
// jQuery Address Plugin v1.3.1
// http://www.asual.com/jquery/address/
// 
// Copyright (c) 2009-2010 Rostislav Hristov
// Dual licensed under the MIT or GPL Version 2 licenses.
// http://jquery.org/license
(function(c){c.address=function(){var G=function(a){c(c.address).trigger(c.extend(c.Event(a),function(){for(var b={},f=c.address.parameterNames(),l=0,C=f.length;l<C;l++)b[f[l]]=c.address.parameter(f[l]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:f,parameters:b,queryString:c.address.queryString()}}.call(c.address)))},z=function(a,b,f){c(c.address).bind(a,b,f);return c.address},A=function(){return M.pushState&&h.state!==m},D=function(){return("/"+
j.pathname.replace(RegExp(h.state),"")+j.search+(J()?"#"+J():"")).replace(pa,"/")},J=function(){var a=j.href.indexOf("#");return a!=-1?H(j.href.substr(a+1),q):""},x=function(){return A()?D():J()},v=function(a){a=a.toString();return(h.strict&&a.substr(0,1)!="/"?"/":"")+a},H=function(a,b){if(h.crawlable&&b)return(a!=""?"!":"")+a;return a.replace(/^\!/,"")},E=function(a,b){return parseInt(a.css(b),10)},aa=function(a){for(var b,f,l=0,C=a.childNodes.length;l<C;l++){if(a.childNodes[l].src)b=String(a.childNodes[l].src);
if(f=aa(a.childNodes[l]))b=f}return b},T=function(){if(!fa){var a=x(),b=i!=a;if(N&&u<523){if(Y!=M.length){Y=M.length;if(S[Y-1]!==m)i=S[Y-1];K(q)}}else if(b)if(O&&u<7)j.reload();else{O&&u<8&&h.history&&L(w,50);i=a;K(q)}}},K=function(a){G(qa);G(a?ra:sa);L(U,10)},U=function(){if(h.tracker!=="null"&&h.tracker!==null){var a=c.isFunction(h.tracker)?h.tracker:o[h.tracker],b=(j.pathname+j.search+(c.address&&!A()?c.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(c.isFunction(a))a(b);else if(c.isFunction(o.urchinTracker))o.urchinTracker(b);
else if(o.pageTracker!==m&&c.isFunction(o.pageTracker._trackPageview))o.pageTracker._trackPageview(b);else o._gaq!==m&&c.isFunction(o._gaq.push)&&o._gaq.push(["_trackPageview",b])}},w=function(){var a="javascript:"+q+";document.open();document.writeln('<html><head><title>"+s.title.replace("'","\\'")+"</title><script>var "+y+' = "'+encodeURIComponent(x())+(s.domain!=j.host?'";document.domain="'+s.domain:"")+"\";<\/script></head></html>');document.close();";if(u<7)t.src=a;else t.contentWindow.location.replace(a)},
P=function(){if(ba&&ta!=-1){var a,b=ba.substr(ta+1).split("&");for(I=0;I<b.length;I++){a=b[I].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0]))h[a[0]]=isNaN(a[1])?/^(true|yes)$/i.test(a[1]):parseInt(a[1],10)!==0;if(/^(state|tracker)$/.test(a[0]))h[a[0]]=a[1]}ba=null}i=x()},V=function(){if(!ua){ua=r;P();var a=function(){Q.call(this);g.call(this)},b=c("body").ajaxComplete(a);a();if(h.wrap){c("body > *").wrapAll('<div style="padding:'+(E(b,"marginTop")+E(b,"paddingTop"))+"px "+
(E(b,"marginRight")+E(b,"paddingRight"))+"px "+(E(b,"marginBottom")+E(b,"paddingBottom"))+"px "+(E(b,"marginLeft")+E(b,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+y+'" style="height:100%;overflow:auto;position:relative;'+(N?window.statusbar.visible&&!/chrome/i.test(ia)?"":"resize:both;":"")+'" />');c("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});N&&c('<style type="text/css" />').appendTo("head").text("#"+y+"::-webkit-resizer { background-color: #fff; }")}if(O&&u<
8){a=s.getElementsByTagName("frameset")[0];t=s.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",t);a[a.cols?"cols":"rows"]+=",0";t.noResize=r;t.frameBorder=t.frameSpacing=0}else{t.style.display="none";t.style.width=t.style.height=0;t.tabIndex=-1;s.body.insertAdjacentElement("afterBegin",t)}L(function(){c(t).bind("load",function(){var f=t.contentWindow;i=f[y]!==m?f[y]:"";if(i!=x()){K(q);j.hash=H(i,r)}});t.contentWindow[y]===m&&w()},50)}else if(N){if(u<418){c(s.body).append('<form id="'+
y+'" style="position:absolute;top:-9999px;" method="get"></form>');ja=s.getElementById(y)}if(j[y]===m)j[y]={};if(j[y][j.pathname]!==m)S=j[y][j.pathname].split(",")}L(function(){G("init");K(q)},1);if(!A())if(O&&u>7||!O&&"on"+ca in o)if(o.addEventListener)o.addEventListener(ca,T,q);else o.attachEvent&&o.attachEvent("on"+ca,T);else za(T,50)}},Q=function(){var a,b=c("a"),f=b.size(),l=-1;L(function(){if(++l!=f){a=c(b.get(l));a.is("[rel*=address:]")&&a.address();L(arguments.callee,1)}},1)},d=function(){if(i!=
x()){i=x();K(q)}},e=function(){if(o.removeEventListener)o.removeEventListener(ca,T,q);else o.detachEvent&&o.detachEvent("on"+ca,T)},g=function(){if(h.crawlable){var a=j.pathname.replace(/\/$/,"");c("body").html().indexOf("_escaped_fragment_")!=-1&&c("a[href]:not([href^=http]), , a[href*="+document.domain+"]").each(function(){var b=c(this).attr("href").replace(/^http:/,"").replace(RegExp(a+"/?$"),"");if(b==""||b.indexOf("_escaped_fragment_")!=-1)c(this).attr("href","#"+c.address.decode(b.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,
"!$2")))})}},k=function(a){return va(ka(a)).replace(/%20/g,"+")},B=function(a){return a.split("#")[0].split("?")[0]},R=function(a){a=B(a);var b=a.replace(pa,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},p=function(a){a=a.split("?");return a.slice(1,a.length).join("?").split("#")[0]},W=function(a,b){if(b=p(b)){params=b.split("&");var f=[];for(I=0;I<params.length;I++){var l=params[I].split("=");if(l[0]==a||c.address.decode(l[0])==
a)f.push(l.slice(1).join("="))}if(f.length!==0)return f.length!=1?f:f[0]}},X=function(a){var b=p(a);a=[];if(b&&b.indexOf("=")!=-1){b=b.split("&");for(var f=0;f<b.length;f++){var l=b[f].split("=")[0];c.inArray(l,a)==-1&&a.push(l)}}return a},ga=function(a){a=a.split("#");return a.slice(1,a.length).join("#")},m,y="jQueryAddress",ca="hashchange",qa="change",ra="internalChange",sa="externalChange",r=true,q=false,h={autoUpdate:r,crawlable:q,history:r,strict:r,wrap:q},F=c.browser,u=parseFloat(c.browser.version),
wa=F.mozilla,O=F.msie,xa=F.opera,N=F.webkit||F.safari,la=q,o;try{o=top.document!==m?top:window}catch(Ca){o=window}var s=o.document,M=o.history,j=o.location,za=setInterval,L=setTimeout,va=encodeURIComponent,ka=decodeURIComponent,pa=/\/{2,9}/g,ia=navigator.userAgent,t,ja,ba=aa(document),ta=ba?ba.indexOf("?"):-1,ma=s.title,Y=M.length,fa=q,ua=q,na=r,ya=r,ha=q,S=[],i=x();if(O){u=parseFloat(ia.substr(ia.indexOf("MSIE")+4));if(s.documentMode&&s.documentMode!=u)u=s.documentMode!=8?7:8;c(document).bind("propertychange",
function(){if(s.title!=ma&&s.title.indexOf("#"+x())!=-1)s.title=ma})}if(la=wa&&u>=1||O&&u>=6||xa&&u>=9.5||N&&u>=312){for(var I=1;I<Y;I++)S.push("");S.push(i);if(xa)history.navigationMode="compatible";if(document.readyState=="complete")var Aa=setInterval(function(){if(c.address){V();clearInterval(Aa)}},50);else{P();c(V)}F=D();if(h.state!==m)if(M.pushState)F.substr(0,3)=="/#/"&&j.replace(h.state.replace(/^\/$/,"")+F.substr(2));else F!="/"&&F.replace(/^\/#/,"")!=J()&&j.replace(h.state.replace(/^\/$/,
"")+"/#"+F);c(window).bind("popstate",d).bind("unload",e)}else!la&&J()!=""||N&&u<418&&J()!=""&&j.search!=""?j.replace(j.href.substr(0,j.href.indexOf("#"))):U();return{bind:function(a,b,f){return z(a,b,f)},init:function(a){return z("init",a)},change:function(a){return z(qa,a)},internalChange:function(a){return z(ra,a)},externalChange:function(a){return z(sa,a)},baseURL:function(){var a=j.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==
m){h.autoUpdate=a;return this}return h.autoUpdate},crawlable:function(a){if(a!==m){h.crawlable=a;return this}return h.crawlable},history:function(a){if(a!==m){h.history=a;return this}return h.history},state:function(a){if(a!==m){h.state=a;return this}return h.state},strict:function(a){if(a!==m){h.strict=a;return this}return h.strict},tracker:function(a){if(a!==m){h.tracker=a;return this}return h.tracker},wrap:function(a){if(a!==m){h.wrap=a;return this}return h.wrap},update:function(){ha=r;this.value(i);
ha=q;return this},encode:function(a){var b=R(a),f=X(a),l=p(a),C=ga(a),Z=a.substr(0,1),$=a.substr(a.length-1),n="";c.each(b,function(da,ea){n+="/"+k(ea)});if(l!==""){n+="?";if(f.length===0)n+=l;else{c.each(f,function(da,ea){var oa=W(ea,a);if(typeof oa!=="string")c.each(oa,function(Da,Ba){n+=k(ea)+"="+k(Ba)+"&"});else n+=k(ea)+"="+k(oa)+"&"});n=n.substr(0,n.length-1)}}if(C!=="")n+="#"+k(C);if(Z!="/"&&n.substr(0,1)=="/")n=n.substr(1);if(Z=="/"&&n.substr(0,1)!="/")n="/"+n;if(/#|&|\?/.test($))n+=$;return n},
decode:function(a){if(a!==m){var b=[];if(typeof a=="object"&&a.length!==m){for(var f=0,l=a.length;f<l;f++)b[f]=ka(a[f].toString().replace(/\+/g,"%20"));return b}else return ka(a.toString().replace(/\+/g,"%20"))}},title:function(a){if(a!==m){L(function(){ma=s.title=a;if(ya&&t&&t.contentWindow&&t.contentWindow.document){t.contentWindow.document.title=a;ya=q}if(!na&&wa)j.replace(j.href.indexOf("#")!=-1?j.href:j.href+"#");na=q},50);return this}return s.title},value:function(a){if(a!==m){a=this.encode(v(a));
if(a=="/")a="";if(i==a&&!ha)return;na=r;i=a;if(h.autoUpdate||ha){K(r);if(A())M[h.history?"pushState":"replaceState"]({},"",h.state.replace(/\/$/,"")+(i==""?"/":i));else{fa=r;S[M.length]=i;if(N)if(h.history){j[y][j.pathname]=S.toString();Y=M.length+1;if(u<418){if(j.search==""){ja.action="#"+H(i,r);ja.submit()}}else if(u<523||i==""){a=s.createEvent("MouseEvents");a.initEvent("click",r,r);var b=s.createElement("a");b.href="#"+H(i,r);b.dispatchEvent(a)}else j.hash="#"+H(i,r)}else j.replace("#"+H(i,r));
else if(i!=x())if(h.history)j.hash="#"+H(i,r);else j.replace("#"+H(i,r));O&&u<8&&h.history&&L(w,50);if(N)L(function(){fa=q},1);else fa=q}}return this}if(!la)return null;return this.decode(v(i))},path:function(a){if(a!==m){var b=p(v(i)),f=ga(v(i));this.value(a+(b?"?"+b:"")+(f?"#"+f:""));return this}return this.decode(B(v(i)))},pathNames:function(){return this.decode(R(v(i)))},queryString:function(a){if(a!==m){var b=ga(v(i));this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}return this.decode(p(v(i)))},
parameter:function(a,b,f){var l,C;if(b!==m){var Z=this.parameterNames();C=[];b=b?va(b):"";for(l=0;l<Z.length;l++){var $=Z[l],n=this.parameter($);if(typeof n=="string")n=[n];if($==a)n=b===null||b===""?[]:f?n.concat([b]):[b];for(var da=0;da<n.length;da++)C.push($+"="+k(n[da]))}c.inArray(a,Z)==-1&&b!==null&&b!==""&&C.push(a+"="+k(b));this.queryString(C.join("&"));return this}return this.decode(W(a,v(i)))},parameterNames:function(){return this.decode(X(v(i)))},hash:function(a){if(a!==m){this.value(v(i).split("#")[0]+
(a?"#"+a:""));return this}return this.decode(ga(v(i)))}}}();c.fn.address=function(G){if(!c(this).attr("address")){var z=function(A){if(c(this).is("a")){var D=G?G.call(this):/address:/.test(c(this).attr("rel"))?c(this).attr("rel").split("address:")[1].split(" ")[0]:c.address.state()!==undefined&&c.address.state()!="/"?c(this).attr("href").replace(RegExp("^(.*"+c.address.state()+"|\\.)"),""):c(this).attr("href").replace(/^(#\!?|\.)/,"");c.address.value(D);A.preventDefault()}};c(this).click(z).live("click",
z).submit(function(A){if(c(this).is("form")){var D=G?G.call(this):c(this).attr("action")+"?"+c.address.decode(c(this).serialize());c.address.value(D);A.preventDefault()}}).attr("address",true)}return this}})(jQuery);
(function(c,G){function z(d,e){for(var g=0;g<w.length;++g)if(w[g][1]==d)return E(w[g][0],e);return false}function A(){var d=window.location.href.split("#");return d[1]&&(d[1].match(/^\//)||d[1]=="")?d[1]:""}function D(d,e){var g=J(d),k=d!=V;if(!k&&e==true)k=true;if(Q&&k&&g){g[0]=x(g[0],g[2]);"callOriginal"in g[0]||aa(d);c.routes.history.push([d,g[0],g[1]]);c.routes.dispatcher(g[0],g[1],d);return true}else return false}function J(d){for(var e=0;e<w.length;++e)if(w[e][0]==d)return[x(w[e][1],e),{},e];
for(e=0;e<P.length;++e){var g=P[e][0].exec(d);if(g){d={};for(var k=0;k<P[e][1].length;++k)d[P[e][1][k]]=g[(k+1)*3-1];return[x(w[e][1],e),d,e]}}return false}function x(d,e){if(typeof d=="string"&&typeof e=="undefined"){for(var g=0;g<w.length;++g)if(w[g][1]==d){e=g;break}throw"Method "+d+" not found in specified routes.";}if(typeof d=="function")return d;var k=w[e][0],B=d.match(/\#(.+)$/)[1],R=d.replace(/\#.+$/,"").split("."),p=G[R[0]];for(g=1;g<R.length;++g)p=p[R[g]];p=p.instance();if("callOriginal"in
p[B])return p[B];var W=p[B];if(typeof p[B]=="undefined")throw'The method "'+B+'" does not exist for the route "'+k+'"';p[B]=function(X){aa(E(k,X));W.apply(p,arguments)};p[B].callOriginal=function(){return W.apply(p,arguments)};return p[B]}function v(){if(!K&&!U)K=c(document).ready(function(){c.address.bind("externalChange",T);Q=U=true;D(A(),true)||D("/")});else Q=U=true}function H(d){var e=[];d=String(d);d=d.replace(/\((\:?[\w]+)\)/g,function(g,k){return""+k+"?"});d=d.replace(/\:([\w]+)(\/?)/g,function(g,
k){e.push(k);return"(([\\w]+)(/|$))"});d=d.replace(/\)\?\/\(/g,")?(");if(d.match(/\*/)){e.push("path");d=d.replace(/\*/g,"((.+$))?")}return[RegExp("^"+d+"$"),e]}function E(d,e){e=e||{};if(typeof e=="string"&&d.match(/\*/))d=d.replace(/\*/,e).replace(/\/\//g,"/");else{if(e.path)d=d.replace(/\*/,e.path.replace(/^\//,""));var g=RegExp("(\\()?\\:([\\w]+)(\\))?(/|$)","g"),k;for(k in e)if(k!="path")d=d.replace(g,function(B,R,p,W,X){return p==k?e[k]+X:(R||"")+":"+p+(W||"")+X})}return d=d.replace(/\([^\)]+\)/g,
"")}function aa(d){if(Q)if(V!=d){c.address.value(d);V=d}}function T(){if(Q){var d=A();U&&d!=V&&D(d)}}if(Number(c.fn.jquery.replace(/\./g))<143)throw"jQuery Routes requires jQuery 1.4.3 or later.";c.routes=function(d,e,g){if(typeof c.address=="undefined")throw"jQuery Address (http://www.asual.com/jquery/address/) is required to run jQuery View Routes";if(typeof d=="string"){if(d=="start")return v();if(d=="stop")Q=false;else{if(d=="match")return J(e);if(d=="set")return D(e);if(d=="get")return A();if(d==
"url")return z(e,g);if(d=="setup")return z(e);if(d=="add")return z(e,g);throw d+" is not a supported method.";}}else{for(var k in d){g=k;w.push([g,d[k]]);P.push(H(g))}v();if(!e)for(e=0;e<d.length;++e)x(d[e][1],e)}};c.routes.dispatcher=function(d,e){d(e)};c.routes.history=[];var K=false,U=false,w=[],P=[],V=false,Q=false})(jQuery,this);
