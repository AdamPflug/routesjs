// jQuery Routes v1.1
// http://routesjs.com/
// 
// Copyright (c) 2011 Syntacticx
// http://syntacticx.com/
// 
// Dual licensed under the MIT or GPL Version 2 licenses.
//
// jQuery Address Plugin v1.3.1
// http://www.asual.com/jquery/address/
// 
// Copyright (c) 2009-2010 Rostislav Hristov
// Dual licensed under the MIT or GPL Version 2 licenses.
// http://jquery.org/license
(function(d){d.address=function(){var G=function(a){d(d.address).trigger(d.extend(d.Event(a),function(){for(var b={},g=d.address.parameterNames(),k=0,C=g.length;k<C;k++)b[g[k]]=d.address.parameter(g[k]);return{value:d.address.value(),path:d.address.path(),pathNames:d.address.pathNames(),parameterNames:g,parameters:b,queryString:d.address.queryString()}}.call(d.address)))},z=function(a,b,g){d(d.address).bind(a,b,g);return d.address},A=function(){return N.pushState&&h.state!==l},D=function(){return("/"+
j.pathname.replace(RegExp(h.state),"")+j.search+(K()?"#"+K():"")).replace(pa,"/")},K=function(){var a=j.href.indexOf("#");return a!=-1?H(j.href.substr(a+1),p):""},w=function(){return A()?D():K()},v=function(a){a=a.toString();return(h.strict&&a.substr(0,1)!="/"?"/":"")+a},H=function(a,b){if(h.crawlable&&b)return(a!=""?"!":"")+a;return a.replace(/^\!/,"")},I=function(a,b){return parseInt(a.css(b),10)},aa=function(a){for(var b,g,k=0,C=a.childNodes.length;k<C;k++){if(a.childNodes[k].src)b=String(a.childNodes[k].src);
if(g=aa(a.childNodes[k]))b=g}return b},S=function(){if(!ga){var a=w(),b=i!=a;if(O&&u<523){if(X!=N.length){X=N.length;if(V[X-1]!==l)i=V[X-1];P(p)}}else if(b)if(Q&&u<7)j.reload();else{Q&&u<8&&h.history&&L(R,50);i=a;P(p)}}},P=function(a){G(qa);G(a?ra:sa);L(ba,10)},ba=function(){if(h.tracker!=="null"&&h.tracker!==null){var a=d.isFunction(h.tracker)?h.tracker:n[h.tracker],b=(j.pathname+j.search+(d.address&&!A()?d.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(d.isFunction(a))a(b);else if(d.isFunction(n.urchinTracker))n.urchinTracker(b);
else if(n.pageTracker!==l&&d.isFunction(n.pageTracker._trackPageview))n.pageTracker._trackPageview(b);else n._gaq!==l&&d.isFunction(n._gaq.push)&&n._gaq.push(["_trackPageview",b])}},R=function(){var a="javascript:"+p+";document.open();document.writeln('<html><head><title>"+r.title.replace("'","\\'")+"</title><script>var "+y+' = "'+encodeURIComponent(w())+(r.domain!=j.host?'";document.domain="'+r.domain:"")+"\";<\/script></head></html>');document.close();";if(u<7)s.src=a;else s.contentWindow.location.replace(a)},
x=function(){if(ca&&ta!=-1){var a,b=ca.substr(ta+1).split("&");for(J=0;J<b.length;J++){a=b[J].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0]))h[a[0]]=isNaN(a[1])?/^(true|yes)$/i.test(a[1]):parseInt(a[1],10)!==0;if(/^(state|tracker)$/.test(a[0]))h[a[0]]=a[1]}ca=null}i=w()},T=function(){if(!ua){ua=q;x();var a=function(){Y.call(this);e.call(this)},b=d("body").ajaxComplete(a);a();if(h.wrap){d("body > *").wrapAll('<div style="padding:'+(I(b,"marginTop")+I(b,"paddingTop"))+"px "+
(I(b,"marginRight")+I(b,"paddingRight"))+"px "+(I(b,"marginBottom")+I(b,"paddingBottom"))+"px "+(I(b,"marginLeft")+I(b,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+y+'" style="height:100%;overflow:auto;position:relative;'+(O?window.statusbar.visible&&!/chrome/i.test(ia)?"":"resize:both;":"")+'" />');d("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});O&&d('<style type="text/css" />').appendTo("head").text("#"+y+"::-webkit-resizer { background-color: #fff; }")}if(Q&&u<
8){a=r.getElementsByTagName("frameset")[0];s=r.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",s);a[a.cols?"cols":"rows"]+=",0";s.noResize=q;s.frameBorder=s.frameSpacing=0}else{s.style.display="none";s.style.width=s.style.height=0;s.tabIndex=-1;r.body.insertAdjacentElement("afterBegin",s)}L(function(){d(s).bind("load",function(){var g=s.contentWindow;i=g[y]!==l?g[y]:"";if(i!=w()){P(p);j.hash=H(i,q)}});s.contentWindow[y]===l&&R()},50)}else if(O){if(u<418){d(r.body).append('<form id="'+
y+'" style="position:absolute;top:-9999px;" method="get"></form>');ja=r.getElementById(y)}if(j[y]===l)j[y]={};if(j[y][j.pathname]!==l)V=j[y][j.pathname].split(",")}L(function(){G("init");P(p)},1);if(!A())if(Q&&u>7||!Q&&"on"+da in n)if(n.addEventListener)n.addEventListener(da,S,p);else n.attachEvent&&n.attachEvent("on"+da,S);else za(S,50)}},Y=function(){var a,b=d("a"),g=b.size(),k=-1;L(function(){if(++k!=g){a=d(b.get(k));a.is("[rel*=address:]")&&a.address();L(arguments.callee,1)}},1)},U=function(){if(i!=
w()){i=w();P(p)}},c=function(){if(n.removeEventListener)n.removeEventListener(da,S,p);else n.detachEvent&&n.detachEvent("on"+da,S)},e=function(){if(h.crawlable){var a=j.pathname.replace(/\/$/,"");d("body").html().indexOf("_escaped_fragment_")!=-1&&d("a[href]:not([href^=http]), , a[href*="+document.domain+"]").each(function(){var b=d(this).attr("href").replace(/^http:/,"").replace(RegExp(a+"/?$"),"");if(b==""||b.indexOf("_escaped_fragment_")!=-1)d(this).attr("href","#"+d.address.decode(b.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,
"!$2")))})}},f=function(a){return va(ka(a)).replace(/%20/g,"+")},o=function(a){return a.split("#")[0].split("?")[0]},B=function(a){a=o(a);var b=a.replace(pa,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},E=function(a){a=a.split("?");return a.slice(1,a.length).join("?").split("#")[0]},t=function(a,b){if(b=E(b)){params=b.split("&");var g=[];for(J=0;J<params.length;J++){var k=params[J].split("=");if(k[0]==a||d.address.decode(k[0])==
a)g.push(k.slice(1).join("="))}if(g.length!==0)return g.length!=1?g:g[0]}},W=function(a){var b=E(a);a=[];if(b&&b.indexOf("=")!=-1){b=b.split("&");for(var g=0;g<b.length;g++){var k=b[g].split("=")[0];d.inArray(k,a)==-1&&a.push(k)}}return a},M=function(a){a=a.split("#");return a.slice(1,a.length).join("#")},l,y="jQueryAddress",da="hashchange",qa="change",ra="internalChange",sa="externalChange",q=true,p=false,h={autoUpdate:q,crawlable:p,history:q,strict:q,wrap:p},F=d.browser,u=parseFloat(d.browser.version),
wa=F.mozilla,Q=F.msie,xa=F.opera,O=F.webkit||F.safari,la=p,n;try{n=top.document!==l?top:window}catch(Ca){n=window}var r=n.document,N=n.history,j=n.location,za=setInterval,L=setTimeout,va=encodeURIComponent,ka=decodeURIComponent,pa=/\/{2,9}/g,ia=navigator.userAgent,s,ja,ca=aa(document),ta=ca?ca.indexOf("?"):-1,ma=r.title,X=N.length,ga=p,ua=p,na=q,ya=q,ha=p,V=[],i=w();if(Q){u=parseFloat(ia.substr(ia.indexOf("MSIE")+4));if(r.documentMode&&r.documentMode!=u)u=r.documentMode!=8?7:8;d(document).bind("propertychange",
function(){if(r.title!=ma&&r.title.indexOf("#"+w())!=-1)r.title=ma})}if(la=wa&&u>=1||Q&&u>=6||xa&&u>=9.5||O&&u>=312){for(var J=1;J<X;J++)V.push("");V.push(i);if(xa)history.navigationMode="compatible";if(document.readyState=="complete")var Aa=setInterval(function(){if(d.address){T();clearInterval(Aa)}},50);else{x();d(T)}F=D();if(h.state!==l)if(N.pushState)F.substr(0,3)=="/#/"&&j.replace(h.state.replace(/^\/$/,"")+F.substr(2));else F!="/"&&F.replace(/^\/#/,"")!=K()&&j.replace(h.state.replace(/^\/$/,
"")+"/#"+F);d(window).bind("popstate",U).bind("unload",c)}else!la&&K()!=""||O&&u<418&&K()!=""&&j.search!=""?j.replace(j.href.substr(0,j.href.indexOf("#"))):ba();return{bind:function(a,b,g){return z(a,b,g)},init:function(a){return z("init",a)},change:function(a){return z(qa,a)},internalChange:function(a){return z(ra,a)},externalChange:function(a){return z(sa,a)},baseURL:function(){var a=j.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==
l){h.autoUpdate=a;return this}return h.autoUpdate},crawlable:function(a){if(a!==l){h.crawlable=a;return this}return h.crawlable},history:function(a){if(a!==l){h.history=a;return this}return h.history},state:function(a){if(a!==l){h.state=a;return this}return h.state},strict:function(a){if(a!==l){h.strict=a;return this}return h.strict},tracker:function(a){if(a!==l){h.tracker=a;return this}return h.tracker},wrap:function(a){if(a!==l){h.wrap=a;return this}return h.wrap},update:function(){ha=q;this.value(i);
ha=p;return this},encode:function(a){var b=B(a),g=W(a),k=E(a),C=M(a),Z=a.substr(0,1),$=a.substr(a.length-1),m="";d.each(b,function(ea,fa){m+="/"+f(fa)});if(k!==""){m+="?";if(g.length===0)m+=k;else{d.each(g,function(ea,fa){var oa=t(fa,a);if(typeof oa!=="string")d.each(oa,function(Da,Ba){m+=f(fa)+"="+f(Ba)+"&"});else m+=f(fa)+"="+f(oa)+"&"});m=m.substr(0,m.length-1)}}if(C!=="")m+="#"+f(C);if(Z!="/"&&m.substr(0,1)=="/")m=m.substr(1);if(Z=="/"&&m.substr(0,1)!="/")m="/"+m;if(/#|&|\?/.test($))m+=$;return m},
decode:function(a){if(a!==l){var b=[];if(typeof a=="object"&&a.length!==l){for(var g=0,k=a.length;g<k;g++)b[g]=ka(a[g].toString().replace(/\+/g,"%20"));return b}else return ka(a.toString().replace(/\+/g,"%20"))}},title:function(a){if(a!==l){L(function(){ma=r.title=a;if(ya&&s&&s.contentWindow&&s.contentWindow.document){s.contentWindow.document.title=a;ya=p}if(!na&&wa)j.replace(j.href.indexOf("#")!=-1?j.href:j.href+"#");na=p},50);return this}return r.title},value:function(a){if(a!==l){a=this.encode(v(a));
if(a=="/")a="";if(i==a&&!ha)return;na=q;i=a;if(h.autoUpdate||ha){P(q);if(A())N[h.history?"pushState":"replaceState"]({},"",h.state.replace(/\/$/,"")+(i==""?"/":i));else{ga=q;V[N.length]=i;if(O)if(h.history){j[y][j.pathname]=V.toString();X=N.length+1;if(u<418){if(j.search==""){ja.action="#"+H(i,q);ja.submit()}}else if(u<523||i==""){a=r.createEvent("MouseEvents");a.initEvent("click",q,q);var b=r.createElement("a");b.href="#"+H(i,q);b.dispatchEvent(a)}else j.hash="#"+H(i,q)}else j.replace("#"+H(i,q));
else if(i!=w())if(h.history)j.hash="#"+H(i,q);else j.replace("#"+H(i,q));Q&&u<8&&h.history&&L(R,50);if(O)L(function(){ga=p},1);else ga=p}}return this}if(!la)return null;return this.decode(v(i))},path:function(a){if(a!==l){var b=E(v(i)),g=M(v(i));this.value(a+(b?"?"+b:"")+(g?"#"+g:""));return this}return this.decode(o(v(i)))},pathNames:function(){return this.decode(B(v(i)))},queryString:function(a){if(a!==l){var b=M(v(i));this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}return this.decode(E(v(i)))},
parameter:function(a,b,g){var k,C;if(b!==l){var Z=this.parameterNames();C=[];b=b?va(b):"";for(k=0;k<Z.length;k++){var $=Z[k],m=this.parameter($);if(typeof m=="string")m=[m];if($==a)m=b===null||b===""?[]:g?m.concat([b]):[b];for(var ea=0;ea<m.length;ea++)C.push($+"="+f(m[ea]))}d.inArray(a,Z)==-1&&b!==null&&b!==""&&C.push(a+"="+f(b));this.queryString(C.join("&"));return this}return this.decode(t(a,v(i)))},parameterNames:function(){return this.decode(W(v(i)))},hash:function(a){if(a!==l){this.value(v(i).split("#")[0]+
(a?"#"+a:""));return this}return this.decode(M(v(i)))}}}();d.fn.address=function(G){if(!d(this).attr("address")){var z=function(A){if(d(this).is("a")){var D=G?G.call(this):/address:/.test(d(this).attr("rel"))?d(this).attr("rel").split("address:")[1].split(" ")[0]:d.address.state()!==undefined&&d.address.state()!="/"?d(this).attr("href").replace(RegExp("^(.*"+d.address.state()+"|\\.)"),""):d(this).attr("href").replace(/^(#\!?|\.)/,"");d.address.value(D);A.preventDefault()}};d(this).click(z).live("click",
z).submit(function(A){if(d(this).is("form")){var D=G?G.call(this):d(this).attr("action")+"?"+d.address.decode(d(this).serialize());d.address.value(D);A.preventDefault()}}).attr("address",true)}return this}})(jQuery);
(function(d,G){function z(c,e){for(var f=0;f<x.length;++f)if(x[f][1]==c)return aa(x[f][0],e);return false}function A(){var c=window.location.href.split("#");return c[1]&&(c[1].match(/^\//)||c[1]=="")?c[1]:""}function D(c,e){var f=K(c),o=c!=Y;if(!o&&e==true)o=true;if(U&&o&&f){f[0]=w(f[0],f[2]);"callOriginal"in f[0]||S(c);d.routes.history.push([c,f[0],f[1]]);d.routes.dispatcher(f[0],f[1],c);return true}else return false}function K(c){for(var e=0;e<x.length;++e)if(x[e][0]==c)return[w(x[e][1],e),{},e];
for(e=0;e<T.length;++e){var f=T[e][0].exec(c);if(f){c={};for(var o=0;o<T[e][1].length;++o)c[T[e][1][o]]=f[(o+1)*3-1];return[w(x[e][1],e),c,e]}}return false}function w(c,e){if(typeof c=="string"&&typeof e=="undefined"){for(var f=0;f<x.length;++f)if(x[f][1]==c){e=f;break}throw"Method "+c+" not found in specified routes.";}if(typeof c=="function")return c;var o=x[e][0],B=c.match(/\#(.+)$/)[1],E=c.replace(/\#.+$/,"").split("."),t=G[E[0]];for(f=1;f<E.length;++f)t=t[E[f]];t=t.instance();if("callOriginal"in
t[B])return t[B];var W=t[B];if(typeof t[B]=="undefined")throw'The method "'+B+'" does not exist for the route "'+o+'"';t[B]=function(M){S(aa(o,M));W.apply(t,arguments)};t[B].callOriginal=function(){return W.apply(t,arguments)};return t[B]}function v(){if(!ba&&!R)ba=d(document).ready(function(){d.address.bind("externalChange",P);U=R=true;D(A(),true)||D("/")});else U=R=true}function H(c){for(var e in c){var f=e;x.push([f,c[e]]);T.push(I(f))}v()}function I(c){var e=[];c=String(c);c=c.replace(/\((\:?[\w]+)\)/g,
function(f,o){return""+o+"?"});c=c.replace(/\:([\w]+)(\/?)/g,function(f,o){e.push(o);return"(([\\w]+)(/|$))"});c=c.replace(/\)\?\/\(/g,")?(");if(c.match(/\*/)){e.push("path");c=c.replace(/\*/g,"((.+$))?")}return[RegExp("^"+c+"$"),e]}function aa(c,e){e=e||{};if(typeof e=="string"&&c.match(/\*/))c=c.replace(/\*/,e).replace(/\/\//g,"/");else{if(e.path)c=c.replace(/\*/,e.path.replace(/^\//,""));var f=RegExp("(\\()?\\:([\\w]+)(\\))?(/|$)","g"),o;for(o in e)if(o!="path")c=c.replace(f,function(B,E,t,W,M){return t==
o?e[o]+M:(E||"")+":"+t+(W||"")+M})}return c=c.replace(/\([^\)]+\)/g,"")}function S(c){if(U)if(Y!=c){d.address.value(c);Y=c}}function P(){if(U){var c=A();R&&c!=Y&&D(c)}}if(Number(d.fn.jquery.replace(/\./g))<143)throw"jQuery Routes requires jQuery 1.4.3 or later.";d.routes=function(c,e,f){if(typeof d.address=="undefined")throw"jQuery Address (http://www.asual.com/jquery/address/) is required to run jQuery View Routes";if(typeof(c=="function"))d.address.bind("externalChange",function(){c(window.location.href.match("#")?
window.location.href.split("#").pop():"")});else if(c===false)d(d.address).unbind("externalChange");else if(typeof c=="string"){if(c=="start")return v();if(c=="stop")U=false;else{if(c=="match")return K(e);if(c=="set")return D(e);if(c=="get")return A();if(c=="url")return z(e,f);if(c=="setup")return z(e);if(c=="add")return z(e,f);throw c+" is not a supported method.";}}else{H(c);if(!e)for(e=0;e<c.length;++e)w(c[e][1],e)}};d.routes.dispatcher=function(c,e){c(e)};d.routes.history=[];var ba=false,R=false,
x=[],T=[],Y=false,U=false})(jQuery,this);
